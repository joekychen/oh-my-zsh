<!DOCTYPE html>
<html><head><title>joekychen/oh-my-zsh » tools › require_tool.sh

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../index.html"></a><h1>require_tool.sh</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre>__require_tool_version_compare <span class="o">()</span>
<span class="o">{</span>
  <span class="o">(</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Locally ignore failures, otherwise we'll exit whenever $1 and $2
are not equal!</p></td><td class="code"><div class="highlight"><pre>    <span class="nb">set</span> +e

<span class="nv">awk_strverscmp</span><span class="o">=</span><span class="s1">&#39;</span>

<span class="s1">#DIVIDER</span>
<span class="s1">  END {</span>
<span class="s1">    while (length(v1) || length(v2)) {</span>

<span class="s1">#DIVIDER</span>
<span class="s1">      if (v1 ~ /^[0-9]/ &amp;&amp; v2 ~ /^[0-9]/) {</span>

<span class="s1">#DIVIDER</span>
<span class="s1">	for (len1 = 1; substr(v1, len1 + 1) ~ /^[0-9]/; len1++) continue</span>
<span class="s1">	for (len2 = 1; substr(v2, len2 + 1) ~ /^[0-9]/; len2++) continue</span>
<span class="s1">	d1 = substr(v1, 1, len1); v1 = substr(v1, len1 + 1)</span>
<span class="s1">	d2 = substr(v2, 1, len2); v2 = substr(v2, len2 + 1)</span>
<span class="s1">	if (d1 ~ /^0/) {</span>
<span class="s1">	  if (d2 ~ /^0/) {</span>

<span class="s1">#DIVIDER</span>
<span class="s1">	    while (d1 ~ /^0/ &amp;&amp; d2 ~ /^0/) {</span>
<span class="s1">	      d1 = substr(d1, 2); len1--</span>
<span class="s1">	      d2 = substr(d2, 2); len2--</span>
<span class="s1">	    }</span>
<span class="s1">	    if (len1 != len2 &amp;&amp; ! (len1 &amp;&amp; len2 &amp;&amp; substr(d1, 1, 1) == substr(d2, 1, 1))) {</span>

<span class="s1">#DIVIDER</span>
<span class="s1">	      d1 = -len1</span>
<span class="s1">	      d2 = -len2</span>
<span class="s1">	    } else {</span>

<span class="s1">#DIVIDER</span>
<span class="s1">	      d1 = &quot;x&quot; d1</span>
<span class="s1">	      d2 = &quot;x&quot; d2</span>
<span class="s1">	    }</span>
<span class="s1">	  } else {</span>

<span class="s1">#DIVIDER</span>
<span class="s1">	    exit 1</span>
<span class="s1">	  }</span>
<span class="s1">	} else {</span>
<span class="s1">	  if (d2 ~ /^0/) {</span>

<span class="s1">#DIVIDER</span>
<span class="s1">	    exit 2</span>
<span class="s1">	  } else {</span>

<span class="s1">#DIVIDER</span>
<span class="s1">	    d1 += 0</span>
<span class="s1">	    d2 += 0</span>
<span class="s1">	  }</span>
<span class="s1">	}</span>
<span class="s1">      } else {</span>

<span class="s1">#DIVIDER</span>
<span class="s1">	if (v1 == &quot;&quot;) d1 = v1; else { d1 = substr(v1, 1, 1); v1 = substr(v1,2) }</span>
<span class="s1">	if (v2 == &quot;&quot;) d2 = v2; else { d2 = substr(v2, 1, 1); v2 = substr(v2,2) }</span>
<span class="s1">      }</span>
<span class="s1">      if (d1 &lt; d2) exit 1</span>
<span class="s1">      if (d1 &gt; d2) exit 2</span>
<span class="s1">    }</span>
<span class="s1">  }</span>
<span class="s1">&#39;</span>
    awk <span class="s2">&quot;$awk_strverscmp&quot;</span> <span class="nv">v1</span><span class="o">=</span><span class="s2">&quot;$1&quot;</span> <span class="nv">v2</span><span class="o">=</span><span class="s2">&quot;$2&quot;</span> /dev/null
    <span class="k">case</span> <span class="nv">$?</span> in
      1<span class="o">)</span>  <span class="nb">echo</span> <span class="s1">&#39;&lt;&#39;</span>;;
      0<span class="o">)</span>  <span class="nb">echo</span> <span class="s1">&#39;=&#39;</span>;;
      2<span class="o">)</span>  <span class="nb">echo</span> <span class="s1">&#39;&gt;&#39;</span>;;
    <span class="k">esac</span>
  <span class="o">)</span>
<span class="o">}</span>


__require_tool_fatal <span class="o">()</span>
<span class="o">{</span>
    <span class="nb">echo</span> <span class="nv">$@</span> &gt;/dev/stderr
    <span class="k">return </span>1
<span class="o">}</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Use only awk features that work with 7th edition Unix awk (1978).
My, what an old awk you have, Mr. Solaris!</p></td><td class="code"><div class="highlight"><pre>require_tool <span class="o">()</span>
<span class="o">{</span>
  <span class="nv">envvar_name</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$1</span> | tr <span class="s1">&#39;[:lower:]&#39;</span> <span class="s1">&#39;[:upper:]&#39;</span><span class="k">)</span>
  <span class="nv">tool</span><span class="o">=</span><span class="k">$(</span>printenv <span class="nv">$envvar_name</span> <span class="o">||</span> <span class="nb">echo</span> <span class="nv">$1</span><span class="k">)</span>
  <span class="nb">local </span><span class="nv">version</span><span class="o">=</span><span class="k">$(</span><span class="nv">$tool</span> --version 2&gt;/dev/null| <span class="se">\</span>
    sed -n <span class="s1">&#39;s/.*[^0-9.]\([0-9]*\.[0-9.]*\).*/\1/p;q&#39;</span><span class="k">)</span>
  <span class="k">if </span><span class="nb">test </span>x<span class="s2">&quot;$version&quot;</span> <span class="o">=</span> x ; <span class="k">then</span>
<span class="k">      </span><span class="nb">echo</span> <span class="s2">&quot;$tool is required&quot;</span> &gt;/dev/stderr
      <span class="k">return </span>1
  <span class="k">fi</span>
<span class="k">  case</span> <span class="k">$(</span>__require_tool_version_compare <span class="s2">&quot;$2&quot;</span> <span class="s2">&quot;$version&quot;</span><span class="k">)</span> in
    <span class="s1">&#39;&gt;&#39;</span><span class="o">)</span>
	  <span class="nb">echo</span> <span class="s2">&quot;$1 $2 or better is required: this is $tool $version&quot;</span> &gt;/dev/stderr
	  <span class="k">return </span>1
	  ;;
  <span class="k">esac</span>
<span class="o">}</span>

usage<span class="o">()</span> <span class="o">{</span>
    cat <span class="s">&lt;&lt;EOF</span>
<span class="s">NAME</span>
<span class="s">    require_tool.sh - Ensure version of a tool is greater than the one expected</span>

<span class="s">SYNOPSYS</span>
<span class="s">    require_tool.sh [ -h ]</span>
<span class="s">                    [ --help ]</span>
<span class="s">                    [ TOOL MIN_VERSION ]</span>

<span class="s">DESCRIPTION</span>
<span class="s">    TOOL is the name or path of the program to check. If the name is specified, its</span>
<span class="s">    path is deduced from PATH environment variable. If environment variable TOOL</span>
<span class="s">    (in upper-case characters) is defined, considers its value as path to the tool.</span>

<span class="s">    MIN_VERSION is a string representing the minimum required version.</span>

<span class="s">BEHAVIOR</span>
<span class="s">    * locate path to the program.</span>
<span class="s">    * execute $ TOOL_PATH --version</span>
<span class="s">    * extract version from standard output.</span>
<span class="s">    * compare this version to the expected one.</span>

<span class="s">OPTIONS</span>
<span class="s">    -h --help</span>
<span class="s">        Display this message and exit 0</span>

<span class="s">ERRORS</span>
<span class="s">    if program is not found or its version is prior to expected version,</span>
<span class="s">    a message is written to error output.</span>

<span class="s">EXIT VALUE</span>
<span class="s">    returns 0 if program version if greater equals than expected version,</span>
<span class="s">    returns 1 otherwise.</span>

<span class="s">EXAMPLE</span>
<span class="s">    $ require_tool.sh emacs 23</span>
<span class="s">    $ CC=g++ require_tool.sh cc 4.6</span>
<span class="s">    $ require_tool.sh zsh 4.5</span>

<span class="s">EOF</span>
<span class="o">}</span>

<span class="k">for </span>arg in <span class="nv">$@</span>; <span class="k">do</span>
<span class="k">    case</span> <span class="nv">$arg</span> in
        -h|--help<span class="o">)</span>
            usage
            <span class="nb">exit </span>0
            ;;
    <span class="k">esac</span>
<span class="k">done</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span>-gt 2 <span class="o">]</span> ; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;ERROR: expecting 2 parameters. Please see option --help&quot;</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

require_tool <span class="nv">$@</span>

</pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Set d1 to be the next thing to compare from v1, and likewise for d2.
Normally this is a single character, but if v1 and v2 contain digits,
compare them as integers and fractions as strverscmp does.</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>Split v1 and v2 into their leading digit string components d1 and d2,
and advance v1 and v2 past the leading digit strings.</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>Compare two fractions.</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>The two components differ in length, and the common prefix
contains only leading zeros.  Consider the longer to be less.</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>Otherwise, compare as strings.</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>A fraction is less than an integer.</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>An integer is greater than a fraction.</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>Compare two integers.</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>The normal case, without worrying about digits.</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>Usage: require_tool program version
Returns: 0 if $1 version if greater equals than $2, 1 otherwise.
In case of error, message is written on error output.</p>

<p>Example: require_tool gcc 4.6
Use GCC environment variable if defined instead of lookup for the tool
in the environment.</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/oh-my-zsh",depth:1}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../javascript/docco.min.js"></script>
</html>
